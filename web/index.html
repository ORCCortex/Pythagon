<!DOCTYPE html>
<html>
<head>
    <base href="$FLUTTER_BASE_HREF">
    
    <meta charset="UTF-8">
    <meta content="IE=Edge" http-equiv="X-UA-Compatible">
    <meta name="description" content="Pythagon - PDF Math Problem Solver">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- iOS meta tags & icons -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Pythagon">
    <link rel="apple-touch-icon" href="icons/Icon-192.png">

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="favicon.png"/>

    <title>Pythagon - PDF Math Solver</title>
    <link rel="manifest" href="manifest.json">
    
    <script type="module">
        // Import Firebase modules
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.0.0/firebase-app.js';
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut } from 'https://www.gstatic.com/firebasejs/10.0.0/firebase-auth.js';

        // Firebase config - SECURE VERSION
        const firebaseConfig = {
            apiKey: "AIzaSyDawDrFn00B7g3IeJmBloi9Vdi8qSMgOPI",
            authDomain: "orccortex-543d1.firebaseapp.com",
            projectId: "orccortex-543d1",
            storageBucket: "orccortex-543d1.firebasestorage.app"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        // Global variables
        let currentToken = '';
        let currentUserId = '';
        let currentProblems = [];
        let isSignedIn = false;

        // Sign in function
        window.signIn = async function() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            if (!email || !password) {
                showMessage('Please enter both email and password', 'error');
                return;
            }
            
            try {
                showMessage('üîÑ Signing in...', 'info');
                
                const userCredential = await signInWithEmailAndPassword(auth, email, password);
                currentToken = await userCredential.user.getIdToken();
                currentUserId = userCredential.user.uid;
                isSignedIn = true;
                
                showMessage('‚úÖ Signed in successfully!', 'success');
                showMainApp();
                
                console.log('Sign in successful, token:', currentToken);
            } catch (error) {
                showMessage('‚ùå Sign in failed: ' + error.message, 'error');
                console.error('Sign in error:', error);
            }
        };

        // Sign up function
        window.signUp = async function() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            if (!email || !password) {
                showMessage('Please enter both email and password', 'error');
                return;
            }
            
            try {
                showMessage('üîÑ Creating account...', 'info');
                
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                currentToken = await userCredential.user.getIdToken();
                currentUserId = userCredential.user.uid;
                isSignedIn = true;
                
                showMessage('‚úÖ Account created successfully!', 'success');
                showMainApp();
                
                console.log('Sign up successful, token:', currentToken);
            } catch (error) {
                showMessage('‚ùå Sign up failed: ' + error.message, 'error');
                console.error('Sign up error:', error);
            }
        };

        // Sign out function
        window.signOutUser = async function() {
            try {
                await signOut(auth);
                currentToken = '';
                currentUserId = '';
                isSignedIn = false;
                currentProblems = [];
                
                showAuthForm();
                showMessage('Signed out successfully', 'success');
            } catch (error) {
                showMessage('Sign out failed: ' + error.message, 'error');
            }
        };

        // Show main app after authentication
        window.showMainApp = function() {
            document.getElementById('authContainer').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            document.getElementById('userEmail').textContent = auth.currentUser?.email || 'User';
        };

        // Show authentication form
        window.showAuthForm = function() {
            document.getElementById('authContainer').style.display = 'block';
            document.getElementById('mainApp').style.display = 'none';
            document.getElementById('problemsList').style.display = 'none';
            document.getElementById('pdfPreview').style.display = 'none';
        };

        // Show message
        window.showMessage = function(message, type) {
            const messageDiv = document.getElementById('messageArea');
            messageDiv.innerHTML = `<div class="message message-${type}">${message}</div>`;
            setTimeout(() => {
                messageDiv.innerHTML = '';
            }, 5000);
        };

        // Upload PDF
        window.uploadPDF = async function() {
            const fileInput = document.getElementById('pdfFile');
            const file = fileInput.files[0];
            
            if (!file) {
                showMessage('Please select a PDF file', 'error');
                return;
            }

            if (!currentToken) {
                showMessage('Please sign in first', 'error');
                return;
            }

            showMessage('üîÑ Uploading PDF...', 'info');
            document.getElementById('uploadBtn').disabled = true;

            const formData = new FormData();
            formData.append('file', file);

            try {
                const response = await fetch('http://localhost:8000/upload', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${currentToken}`
                    },
                    body: formData
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.detail || 'Upload failed');
                }

                const result = await response.json();
                currentProblems = result.problems || [];
                
                showMessage(`‚úÖ Upload successful! ${result.total_pages || 0} pages processed.`, 'success');
                
                // Display PDF preview and problems
                displayPDFPreview(file);
                displayProblems(result);
                
                // Start checking status
                setTimeout(() => checkAllProblemStatus(), 3000);

            } catch (error) {
                showMessage(`‚ùå Upload failed: ${error.message}`, 'error');
                console.error('Upload error:', error);
            } finally {
                document.getElementById('uploadBtn').disabled = false;
            }
        };

        // Display PDF preview
        window.displayPDFPreview = function(file) {
            const previewDiv = document.getElementById('pdfPreview');
            const url = URL.createObjectURL(file);
            
            previewDiv.innerHTML = `
                <h3>üìÑ PDF Preview</h3>
                <embed src="${url}" type="application/pdf" width="100%" height="400px" />
                <p><strong>File:</strong> ${file.name} (${Math.round(file.size / 1024)} KB)</p>
            `;
            previewDiv.style.display = 'block';
        };

        // Display problems for each page
        window.displayProblems = function(uploadResult) {
            const problemsDiv = document.getElementById('problemsList');
            problemsDiv.innerHTML = '<h3>üìã Problems by Page</h3>';
            
            if (!uploadResult.problems || uploadResult.problems.length === 0) {
                problemsDiv.innerHTML += '<p>No problems found in the PDF.</p>';
                problemsDiv.style.display = 'block';
                return;
            }
            
            uploadResult.problems.forEach((problem, index) => {
                const problemDiv = document.createElement('div');
                problemDiv.className = 'problem-card';
                problemDiv.id = `problem-${problem.id}`;
                
                problemDiv.innerHTML = `
                    <div class="problem-header">
                        <h4>üìÑ Page ${problem.page_number || index + 1}</h4>
                        <span class="status-badge status-${problem.status || 'pending'}">${problem.status || 'pending'}</span>
                    </div>
                    <div class="problem-content">
                        <div class="extracted-text">
                            <h5>üìù Extracted Text:</h5>
                            <div id="text-${problem.id}" class="text-content">
                                ${problem.status === 'processing' ? '‚è≥ Processing...' : (problem.extracted_text || 'No text extracted')}
                            </div>
                        </div>
                        <div class="math-expressions">
                            <h5>üßÆ Math Expressions:</h5>
                            <div id="math-${problem.id}" class="math-content">
                                ${problem.status === 'processing' ? '‚è≥ Processing...' : (problem.math_expressions?.length > 0 ? problem.math_expressions.join(', ') : 'No math expressions found')}
                            </div>
                        </div>
                        <div class="actions">
                            <button class="solve-btn" onclick="solveProblem('${problem.id}', ${problem.page_number || index + 1})" 
                                    ${problem.status !== 'completed' ? 'disabled' : ''}>
                                üßÆ Solve Problem
                            </button>
                        </div>
                        <div id="solution-${problem.id}" class="solution-content" style="display: none;">
                            <h5>üí° Solution:</h5>
                            <div class="solution-text"></div>
                        </div>
                    </div>
                `;
                
                problemsDiv.appendChild(problemDiv);
            });
            
            problemsDiv.style.display = 'block';
        };

        // Check status of all problems
        window.checkAllProblemStatus = async function() {
            if (!currentProblems.length) return;

            for (const problem of currentProblems) {
                if (problem.status !== 'completed') {
                    await checkProblemStatus(problem.id);
                }
            }

            // Check again in 5 seconds if any are still processing
            const stillProcessing = currentProblems.some(p => p.status === 'processing');
            if (stillProcessing) {
                setTimeout(() => checkAllProblemStatus(), 5000);
            }
        };

        // Check individual problem status
        window.checkProblemStatus = async function(problemId) {
            try {
                const response = await fetch(`http://localhost:8000/problem/${problemId}/status`, {
                    headers: {
                        'Authorization': `Bearer ${currentToken}`
                    }
                });

                if (!response.ok) return;

                const result = await response.json();
                
                // Update problem in array
                const problemIndex = currentProblems.findIndex(p => p.id === problemId);
                if (problemIndex !== -1) {
                    currentProblems[problemIndex].status = result.status;
                    currentProblems[problemIndex].extracted_text = result.extracted_text;
                    currentProblems[problemIndex].math_expressions = result.math_expressions;
                }

                // Update UI
                updateProblemDisplay(problemId, result);

            } catch (error) {
                console.error('Status check error:', error);
            }
        };

        // Update problem display
        window.updateProblemDisplay = function(problemId, problemData) {
            const statusBadge = document.querySelector(`#problem-${problemId} .status-badge`);
            const textDiv = document.getElementById(`text-${problemId}`);
            const mathDiv = document.getElementById(`math-${problemId}`);
            const solveBtn = document.querySelector(`#problem-${problemId} .solve-btn`);

            if (statusBadge) {
                statusBadge.textContent = problemData.status;
                statusBadge.className = `status-badge status-${problemData.status}`;
            }

            if (textDiv) {
                textDiv.innerHTML = problemData.extracted_text ? 
                    `<pre>${problemData.extracted_text.substring(0, 500)}${problemData.extracted_text.length > 500 ? '...' : ''}</pre>` : 
                    'No text extracted';
            }

            if (mathDiv) {
                mathDiv.textContent = problemData.math_expressions?.length > 0 ? 
                    problemData.math_expressions.slice(0, 5).join(', ') + (problemData.math_expressions.length > 5 ? '...' : '') : 
                    'No math expressions found';
            }

            if (solveBtn) {
                solveBtn.disabled = problemData.status !== 'completed';
            }
        };

        // Solve problem
        window.solveProblem = async function(problemId, pageNumber) {
            const solutionDiv = document.getElementById(`solution-${problemId}`);
            const solveBtn = document.querySelector(`#problem-${problemId} .solve-btn`);
            
            solveBtn.disabled = true;
            solveBtn.textContent = '‚è≥ Solving...';
            
            solutionDiv.style.display = 'block';
            solutionDiv.querySelector('.solution-text').innerHTML = 'üîÑ Processing solution...';

            try {
                const response = await fetch(`http://localhost:8000/solve/${problemId}`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${currentToken}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.detail || 'Solve failed');
                }

                const result = await response.json();
                
                // Wait a bit then check solution status
                setTimeout(() => checkSolutionStatus(result.id, problemId), 3000);

            } catch (error) {
                solutionDiv.querySelector('.solution-text').innerHTML = `<div style="color: red;">‚ùå Error: ${error.message}</div>`;
                console.error('Solve error:', error);
            } finally {
                solveBtn.disabled = false;
                solveBtn.textContent = 'üßÆ Solve Problem';
            }
        };

        // Check solution status
        window.checkSolutionStatus = async function(solutionId, problemId) {
            try {
                const response = await fetch(`http://localhost:8000/solve/${solutionId}/status`, {
                    headers: {
                        'Authorization': `Bearer ${currentToken}`
                    }
                });

                if (!response.ok) return;

                const result = await response.json();
                const solutionDiv = document.getElementById(`solution-${problemId}`);
                
                if (result.status === 'completed') {
                    solutionDiv.querySelector('.solution-text').innerHTML = `
                        <div class="solution-result">
                            <p><strong>Math Expression:</strong> ${result.math_expression || 'N/A'}</p>
                            <p><strong>Solution Steps:</strong></p>
                            <pre>${JSON.stringify(result.solution_steps, null, 2) || 'No detailed steps available'}</pre>
                            <p><strong>Final Answer:</strong> <span class="final-answer">${result.final_answer || 'Could not solve'}</span></p>
                        </div>
                    `;
                } else if (result.status === 'solving') {
                    setTimeout(() => checkSolutionStatus(solutionId, problemId), 3000);
                } else {
                    solutionDiv.querySelector('.solution-text').innerHTML = `<div style="color: orange;">‚ö†Ô∏è Status: ${result.status}</div>`;
                }

            } catch (error) {
                console.error('Solution status check error:', error);
            }
        };

        // Handle Enter key in password field
        window.handleKeyPress = function(event) {
            if (event.key === 'Enter') {
                signIn();
            }
        };

        // Initialize app when DOM loads
        window.addEventListener('DOMContentLoaded', () => {
            showAuthForm();
            console.log('Pythagon PDF Solver initialized');
        });
    </script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .content {
            padding: 30px;
        }
        
        /* Authentication Styles */
        .auth-container {
            max-width: 400px;
            margin: 0 auto;
            text-align: center;
        }
        
        .auth-form {
            background: #f8f9fa;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .auth-form h2 {
            margin-bottom: 30px;
            color: #2c3e50;
            font-size: 1.8em;
        }
        
        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 600;
        }
        
        .form-group input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e1e8ed;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        .form-group input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }
        
        .auth-buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }
        
        .auth-buttons button {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }
        
        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(149, 165, 166, 0.3);
        }
        
        /* Main App Styles */
        .main-app {
            display: none;
        }
        
        .app-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #ecf0f1;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #3498db, #2980b9);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        .sign-out-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.3s;
        }
        
        .sign-out-btn:hover {
            background: #c0392b;
        }
        
        /* Upload Section */
        .upload-section {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .upload-section h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.5em;
        }
        
        .file-input-wrapper {
            position: relative;
            display: inline-block;
            margin-bottom: 20px;
        }
        
        .file-input {
            display: none;
        }
        
        .file-input-label {
            display: inline-block;
            padding: 15px 30px;
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: white;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .file-input-label:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(243, 156, 18, 0.3);
        }
        
        .upload-btn {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-left: 15px;
        }
        
        .upload-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(39, 174, 96, 0.3);
        }
        
        .upload-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        /* Message Styles */
        .message {
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            font-weight: 600;
        }
        
        .message-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .message-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f1b0b7;
        }
        
        .message-info {
            background: #cce7ff;
            color: #004085;
            border: 1px solid #a2d2ff;
        }
        
        /* Status Badge Styles */
        .status-badge {
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .status-pending { background: #f39c12; color: white; }
        .status-processing { background: #3498db; color: white; }
        .status-completed { background: #27ae60; color: white; }
        .status-failed { background: #e74c3c; color: white; }
        
        /* Problem Card Styles */
        .problem-card {
            border: 1px solid #e1e8ed;
            border-radius: 15px;
            margin: 20px 0;
            padding: 25px;
            background: white;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            transition: all 0.3s;
        }
        
        .problem-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }
        
        .problem-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #ecf0f1;
        }
        
        .problem-header h4 {
            color: #2c3e50;
            font-size: 1.3em;
        }
        
        .problem-content h5 {
            color: #34495e;
            margin: 20px 0 10px 0;
            font-size: 1.1em;
        }
        
        .text-content {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #3498db;
            max-height: 200px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 15px;
        }
        
        .math-content {
            background: #e8f4f8;
            padding: 15px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            color: #2c3e50;
            border-left: 4px solid #17a2b8;
            margin-bottom: 20px;
        }
        
        .actions {
            text-align: center;
            margin: 25px 0;
        }
        
        .solve-btn {
            background: linear-gradient(135deg, #e67e22, #d35400);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .solve-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(230, 126, 34, 0.3);
        }
        
        .solve-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .solution-content {
            margin-top: 25px;
            padding: 25px;
            background: linear-gradient(135deg, #e8f5e8, #d5f4d5);
            border-radius: 15px;
            border-left: 5px solid #27ae60;
        }
        
        .solution-result {
            font-family: 'Courier New', monospace;
            line-height: 1.6;
        }
        
        .final-answer {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            padding: 8px 15px;
            border-radius: 8px;
            font-weight: bold;
            display: inline-block;
            margin-top: 10px;
        }
        
        pre {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 10px;
            overflow-x: auto;
            font-size: 13px;
            line-height: 1.4;
            margin: 15px 0;
        }
        
        .preview-section {
            display: none;
            margin-top: 30px;
        }
        
        embed {
            border: 2px solid #e1e8ed;
            border-radius: 10px;
            margin: 15px 0;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 15px;
            }
            
            .content {
                padding: 20px;
            }
            
            .header {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .auth-form {
                padding: 30px 20px;
            }
            
            .auth-buttons {
                flex-direction: column;
            }
            
            .app-header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .upload-btn {
                margin-left: 0;
                margin-top: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìê Pythagon</h1>
            <p>AI-Powered PDF Math Problem Solver</p>
        </div>
        
        <div class="content">
            <!-- Authentication Container -->
            <div id="authContainer" class="auth-container">
                <div class="auth-form">
                    <h2>üîê Sign In to Continue</h2>
                    <div class="form-group">
                        <label for="email">Email Address</label>
                        <input type="email" id="email" placeholder="Enter your email" />
                    </div>
                    <div class="form-group">
                        <label for="password">Password</label>
                        <input type="password" id="password" placeholder="Enter your password" onkeypress="handleKeyPress(event)" />
                    </div>
                    <div class="auth-buttons">
                        <button class="btn-primary" onclick="signIn()">üöÄ Sign In</button>
                        <button class="btn-secondary" onclick="signUp()">üìù Sign Up</button>
                    </div>
                </div>
            </div>
            
            <!-- Main Application -->
            <div id="mainApp" class="main-app">
                <div class="app-header">
                    <div class="user-info">
                        <div class="user-avatar">üë§</div>
                        <div>
                            <div>Welcome back!</div>
                            <div id="userEmail" style="font-size: 0.9em; opacity: 0.8;"></div>
                        </div>
                    </div>
                    <button class="sign-out-btn" onclick="signOutUser()">üö™ Sign Out</button>
                </div>
                
                <div class="upload-section">
                    <h3>üì§ Upload Your PDF</h3>
                    <p style="margin-bottom: 20px; color: #666;">Select a PDF file containing math problems to analyze and solve</p>
                    
                    <div class="file-input-wrapper">
                        <input type="file" id="pdfFile" class="file-input" accept=".pdf" />
                        <label for="pdfFile" class="file-input-label">üìÅ Choose PDF File</label>
                    </div>
                    
                    <button id="uploadBtn" class="upload-btn" onclick="uploadPDF()">üöÄ Upload & Process</button>
                </div>
                
                <div id="messageArea"></div>
                
                <div id="pdfPreview" class="preview-section"></div>
                
                <div id="problemsList" class="preview-section"></div>
            </div>
        </div>
    </div>
    
    <!-- Fallback for Flutter Web (if needed) -->
    <script>
        // This can be used as a fallback or for Flutter Web integration
        // if (window.location.search.includes('flutter=true')) {
        //     document.body.innerHTML = '<script src="flutter_bootstrap.js" async></script>';
        // }
    </script>
</body>
</html>
